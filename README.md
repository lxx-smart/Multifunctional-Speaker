# Multifunctional-Speaker
### **基于ESP32的蓝牙/TF卡/U盘多功能音箱**  

## 目前只有蓝牙功能可以使用，其他功能敬请期待###

---

#### **一、核心功能概述**  
本设备以**ESP32-WROOM-32D**为主控芯片，聚焦于蓝牙音频传输、TF卡本地播放两大核心功能，通过**CH376存储控制芯片**实现外部存储设备的高效读取。设备设计简洁，支持主流音频格式解码与稳定播放，适用于基础音乐播放场景。  

---

#### **二、硬件设计精简版**  
1. **主控与存储模块**  
   - **主控芯片**：ESP32-WROOM-32D，集成蓝牙5.0（A2DP协议）音频传输功能，支持手机音频流输入。  
   - **存储扩展**：  
     - **TF卡槽**：通过SPI接口连接，支持最大32GB容量（FAT32/exFAT文件系统）。  
     - **U盘接口**：通过CH376芯片实现USB HOST功能，支持即插即用，兼容FAT16/FAT32文件系统。  
   - **音频输出**：I2S接口连接DAC（如PCM5102A或MAX98357A），输出模拟音频信号至功放或扬声器。  

2. **CH376芯片的核心作用**  
   - **功能**：作为存储控制器，CH376负责TF卡/U盘的初始化、文件系统解析及数据读取，通过SPI或并口与ESP32通信。  
   - **优势**：内置FAT文件系统固件，简化单片机对存储设备的操作，支持快速文件遍历与音频数据流传输。  

---

#### **三、软件功能实现**  
1. **蓝牙音频传输**  
   - 基于ESP32的A2DP协议栈，接收手机音频流数据，通过I2S接口传输至DAC解码播放。  

2. **本地音频播放（TF卡/U盘）**  
   - **CH376驱动流程**：  
     1. 初始化CH376芯片，设置SPI通信模式。  
     2. 检测存储设备连接状态，挂载文件系统。  
     3. 遍历指定目录，读取音频文件（如MP3/WAV）并传输至ESP32缓冲区。  
   - **音频解码**：ESP32通过软件解码处理音频数据。  

---

#### **四、技术亮点与优化**  
1. **存储兼容性**  
   - CH376支持多存储设备热插拔，自动切换TF卡优先级，确保无缝播放。  
2. **低资源占用**  
   - 通过CH376硬件解析文件系统，减少ESP32的运算负担，优化内存使用。  
3. **即插即用设计**  
   - U盘插入后自动识别并加载文件列表，用户无需手动配置。  

---

#### **五、典型使用场景**  
- **家庭音乐播放**：通过蓝牙连接手机，或插入TF卡播放本地音乐。  
- **便携户外音箱**：依赖本地存储的离线播放能力，摆脱网络依赖。  

---

#### **六、开发资源参考**  
- **CH376驱动代码**：可参考官方例程实现存储设备初始化与文件读写。  
- **蓝牙音频库**：ESP-ADF库提供A2DP协议栈及音频流处理接口。  

---  
通过精简设计，本设备在保持核心功能的同时降低了复杂度，适合快速开发与基础应用。
